$(function(){function t(t){$.ajax({type:"post",url:"./php/mall.php",dataType:"json",data:t,success:function(t){$(".lol-list-main ul").empty();var e="",a=t.list;$.each(a,function(t,a){e+="<li><dl><dt><img src='"+a.pic+"'></dt><dd><div class='tit_area'><span>"+a.title.substring(0)+"</span></div><div class='attr'><span>￥"+a.price+"</span></div><div class='attr'><a href='#cartDialog' title='"+a.id+"' data-rel='popup' data-position-to='window' data-transition='pop' class='ui-shadow ui-btn ui-corner-all addcart'>加入购物车</a></div></dd></dl></li>"}),$(".lol-list").append(e),$(".addcart").on("tap",function(){var t={id:$(this).attr("title")};$.ajax({type:"post",url:"./php/goods.php",dataType:"json",data:t,success:function(t){var e=$("#user").text(),a=t.goods;$.each(a,function(t,a){var n=a.title,s=a.pic,i=a.category,c=a.price,o={username:e,title:n,pic:s,category:i,price:c};"未登录"==o.username?($(".login-in").css("display","none"),$(".login-out").css("display","block")):$.ajax({type:"post",url:"./php/addcart.php",data:o,success:function(t){1==t&&($(".login-in").css("display","block"),$(".login-out").css("display","none"))}})})}})})},error:function(){$(".lol-list").html("请求数据失败")}})}function e(t){$.ajax({type:"post",url:"./php/cart.php",dataType:"json",data:t,success:function(a){$(".u-cart").empty(),$(".count").empty();var n="",s=[],i=0,c=a.cart;$.each(c,function(t,e){n+="<li id='"+e.id+"'><div class='u-cart-pic'><img src='"+e.pic+"'></div><div class='u-carted-detail'><p class='u-name'>"+e.title.substring(0)+"</p><p class='u-cate'>类型："+e.category+"</p></div><div class='u-carted-price'><p class='u-price'>￥"+e.price+"</p></div><div class='u-cart-del'><a href='#' class='cart-delete' title='"+e.id+"' >删除</a></div></li>";var a=e.price;s.push(a),i+=parseFloat(s[t])}),$(".u-cart").append(n),$("#count").text("￥"+i.toFixed(2)),$(".pay").text("￥"+i.toFixed(2)),$(".cart-delete").on("tap",function(){var a={id:$(".cart-delete").attr("title")};$.ajax({type:"get",url:"./php/deletecart.php",data:a,success:function(a){if(0!=a){$("#"+a).remove(),e(t);var n=$(".u-cart li").length;0==n&&($("#count").text("￥0"),$(".pay").text("￥0"))}}})})}})}function a(){var t=$("#count").text();"￥0"==t?($(".buy").css("display","none"),$(".nobuy").css("display","block")):($(".buy").css("display","block"),$(".nobuy").css("display","none"))}var n=(new Slider($(".banner"),{time:3888,delay:400,event:"hover",auto:!0,mode:"fade",controller:$(".pagination"),activeControllerCls:"active"}),{category:"英雄"});t(n),$(".lol-nav ul li a").each(function(e){$(this).on("tap",function(){$(".lol-nav ul li a.ui-btn-active").removeClass("ui-btn-active"),$(this).addClass("ui-btn-active");var e={category:$(".ui-btn-active").text()};t(e)})}),$("#login").on("tap",function(){var t={username:$("#l-un").val(),password:$("#l-pw").val()};""==t.username||""==t.password?$("#loginmsg").text("用户名和密码不能为空！"):$.ajax({async:!1,type:"post",url:"./php/login.php",dataType:"text",data:t,success:function(t){1==t?($("#loginmsg").text("登录成功！"),window.location.href="index.html"):$("#loginmsg").text("账号或密码错误！")}})}),$("#register").on("tap",function(){var t={username:$("#r-un").val(),password:$("#r-pw").val()};""==t.username||""==t.password?$("#registermsg").text("用户名和密码不能为空！"):$.ajax({cache:!1,type:"post",url:"./php/register.php",data:t,success:function(t){1==t?($(".regsuc").css("display","block"),$("#registermsg").text("")):($("#registermsg").text("账号已存在，注册失败！"),$(".regsuc").css("display","none"))}})}),$(".user-input").on("tap",function(){$("#loginmsg").text(""),$("#registermsg").text(""),$(".regsuc").css("display","none")}),$.ajax({type:"get",url:"./php/status.php",dataType:"text",success:function(t){if(0==t)$(".status").text("未登录"),$(".mallcart").css("display","none"),$(".log-reg").css("display","block"),$(".exit").css("display","none"),$("#user").text("未登录"),$("#user").css("display","block"),$(".statement-footer").css("display","none");else{$(".status").text("Hi,"+t),$(".mallcart").css("display","block"),$(".log-reg").css("display","none"),$(".exit").css("display","block"),$("#user").text(t),$("#user").css("display","none"),$(".statement-footer").css("display","block");var a={username:t};e(a)}}}),$(".my-cart-trigger").on("tap",function(){var t={username:$("#user").text()};e(t)}),$("#in-cart").on("tap",function(){var t={username:$("#user").text()};e(t)}),$(".buy").on("tap",function(){var t={username:$("#user").text()};$.ajax({type:"get",url:"./php/statement.php",data:t,success:function(t){if(0!=t){$(".u-cart").find("li").remove();var e=$(".u-cart li").length;0==e&&($("#count").text("￥0"),$(".pay").text("￥0"))}}})}),a(),$("#statement").on("tap",function(){a()}),$(".exit").on("tap",function(){$.ajax({type:"get",url:"./php/exit.php",dataType:"text",success:function(t){1==t&&(window.location.href="index.html")}})}),$(".gotop").on("tap",function(){$(window).scrollTop();$("body,html").animate({scrollTop:0},500)})}),$(function(t,e,a,n){Slider=function(e,a){"use strict";function n(){var e=v.children();s(),"hover"==y?e.mouseover(function(){l();var e=t(this).index();o(e,a.mode)}).mouseout(function(){h&&i()}):e.click(function(){l();var e=t(this).index();o(e,a.mode),h&&i()}),h&&i()}function s(){var t=e.children().first();"slide"==a.mode?t.width(w):t.children().css({position:"absolute",left:0,top:0}).first().siblings().hide()}function i(){u=setInterval(function(){c(d)},a.time)}function c(t){var e;e=t==x-1?0:t+1,o(e,a.mode)}function o(t,e){g.stop(!0,!0),m.stop(!0,!0),"slide"==e?function(){if(t>d)g.animate({left:"-="+Math.abs(t-d)*b+"px"},f);else{if(!(t<d))return;g.animate({left:"+="+Math.abs(t-d)*b+"px"},f)}}():function(){g.children(":visible").index()!=t&&g.children().fadeOut(f).eq(t).fadeIn(f)}();try{v.children("."+$).removeClass($),v.children().eq(t).addClass($)}catch(n){}d=t,a.exchangeEnd&&"function"==typeof a.exchangeEnd&&a.exchangeEnd.call(this,d)}function l(){clearInterval(u)}function r(){l(),c(0==d?x-2:d-2),h&&i()}function p(){l(),c(d==x-1?-1:d),h&&i()}if(e){var u,a=a||{},d=0,$=a.activeControllerCls,f=a.delay,h=a.auto,v=a.controller,y=a.event,g=e.children().first(),m=g.children(),x=m.length,b=e.width(),w=b*m.length;return n(),{prev:function(){r()},next:function(){p()}}}}}(jQuery,window,document));